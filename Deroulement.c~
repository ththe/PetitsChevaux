#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include "Action_chevaux.h"
#include "Affichage.h"
#include "petitchevaux.h"
#include "Verification.h"
#include "Deroulement.h"


int QuiCquiCommence(){
    int a,i,joueur,tmp, t[MAXI], b,c;
    tmp=0;
    b=0;
    c=0;
    for(joueur=1; joueur<= 4; joueur++){
        printf("Joueur %d, veuillez presser ENTREE pour lancer un dés \n", joueur);
        scanf("%lc",&a); 
        b=lancer_des();
        printf("Joueur %d vous avez tire le nombre %d \n",joueur, b);getchar();
        if(b > c){
            tmp=joueur; //
            c=b;
            printf("Pour l'instant le joueur %d est en tete, il a tire un %d \n", joueur,b);
        }
    }
    return tmp;
}
//Cette fonction permet de déterminer qui commence: Chaque joueur tire un dés, celui qui tire le plus grand nombre commence, ensuite les tours continuent dans le sens horaire.




int lancer_des (){
    srand(time(NULL));
     return rand()%(6)+1;
}


int Choix(int joueur){
    int choix;
    printf("Joueur %d quel action voulez vous faire\n(1) Sortir un pion\n(2) Déplacer un pion\n",joueur);
    scanf("%d",&choix);
    while(choix!=1 && choix!=2){
        printf("ERREUR,veuillez choisir quel action voulez vous faire\n(1) Sortir un pion\n(2) Déplacer un pion\n");
        scanf("%d",&choix);
    }
    getchar();
    return choix;
}


void action(int joueur, int plateau[][15], chevaux chevaux[]){
  char a;
  int c;
  printf("Joueur %d veuillez tirer un des en appuyant sur ENTREE \n",joueur);
  scanf("%c",&a);
  int des=lancer_des();
  printf("Vous avez tiré un %d\n",des);
  if(des==6){
    c=Choix(joueur);
    if(c==1 && sorti_possible(joueur,chevaux)){
      sortir_pion(joueur,chevaux);
      afficher_plateau(plateau,chevaux);
      getchar();
      printf("Joueur %d vous avez tirer un 6 vous pouvez rejouer\n",joueur);
      action(joueur,plateau,chevaux);
    }else if(c==2 && deplacement_possible(joueur,chevaux,des)==1){
      Deplacement(joueur,chevaux,des);
      afficher_plateau(plateau,chevaux);
      getchar();
      printf("Joueur %d vous avez tirer un 6 vous pouvez rejouer\n",joueur);
      action(joueur,plateau,chevaux);
    }
    else{
      if(c==1 && deplacement_possible(joueur,chevaux,des)==1){
	printf("Sorti de pion impossible mais un déplacement est possible\n");
	Deplacement(joueur,chevaux,des);
	afficher_plateau(plateau,chevaux);
	getchar();
	printf("Joueur %d vous avez tirer un 6 vous pouvez rejouer\n",joueur);
	action(joueur,plateau,chevaux);
      }
      else if(c==2 && sorti_possible(joueur,chevaux)){
	printf("Déplacements impossible mais vous pouvez sortir un pion\n");
	sortir_pion(joueur,chevaux);
	afficher_plateau(plateau,chevaux);
	getchar();
	printf("Joueur %d vous avez tirer un 6 vous pouvez rejouer\n",joueur);
	action(joueur,plateau,chevaux);
      }
      else{
	printf("Déplacement impossible\n\n");
      }
    }
  }
  else if(deplacement_possible(joueur,chevaux,des)==1){
    Deplacement(joueur,chevaux,des);
    afficher_plateau(plateau,chevaux);
    getchar();
  }
  else{
    printf("Déplacement impossible\n\n");
  } 
}	
